
`r spp_lab <- species_groups[match(spp, species_groups$code_sra), "common_name"]` 

## `r spp_lab`

`r fig_cap <- fig_nums(name = paste0("fig:overlap_map_", spp), caption = paste0("Sum of density overlap and captures per fishing method for ", spp_lab, "."))`

``` {r, echo = FALSE, fig.cap = fig_cap, fig.height = 6, fig.width = 6}
gg <- plot_sra_maps(rr)
  
odat_sp <- observer_dat_sp %>% as.data.frame() %>% rename(x = coords.x1, y = coords.x2) %>% filter(n_captures > 0) %>% group_by(x, y, method) %>% dplyr::summarise(value = sum(unlist(sra_species) %in% spp), .groups = "keep") %>% rename(group = method) %>% filter(value > 0)
  
gg + geom_point(data = odat_sp, aes(x, y, size = value), col = "red", shape = 21, stroke = 0.1) + guides(size = "none")
```

```{r, echo = FALSE, results = 'asis', size = 'scriptsize'}
tab1 <- dfr@data %>%
     aggregate_captures("method", list("id" = spp, "other" = species[-match(spp, species)])) %>% filter(group == "id") %>% dplyr::select(-group)
tab2 <- dfr@data %>% group_by(method) %>%
     summarise(overlap = sum(density_overlap))
tab <- full_join(tab1, tab2, by = "method") %>% as.data.frame()

tab[,2] <- sprintf("%.0f", tab[,2])
tab[,3] <- sprintf("%.2f", tab[,3])

tab2 <- t(tab[,2:3]) %>% as.data.frame()
colnames(tab2) <- tab[,1]
rownames(tab2) <- c("Captures", "Overlap")

tab_cap <- tab_nums(name = paste0("tab:table_", spp), caption = paste0("Sum of density overlap and captures for ", spp_lab))
pandoc.table(tab2, caption = tab_cap, split.table = Inf)
```
